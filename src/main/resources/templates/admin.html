<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Page</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .header {
            background-color: black; /* Цвет фона шапки */
            color: white; /* Цвет текста шапки */
            padding: 10px; /* Отступы внутри шапки */
        }

        .header .logout {
            color: gray; /* Цвет текста для кнопки выхода */
            float: right; /* Выравнивание кнопки выхода вправо */
        }
    </style>
</head>
<body>
<div class="header">
    <span th:text="'Email: ' + ${currentUser.email} + ' with roles: ' + ${currentUser.roles}"></span>
    <a class="logout" th:href="@{/logout}">Logout</a>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <h2>Navigation</h2>
            <ul class="list-group">
                <!-- Проверка на наличие роли "ADMIN" -->
                <li class="list-group-item" th:if="${@adminController.hasRole(currentUser, 'ROLE_ADMIN')}">
                    <a href="http://localhost:8080/admin">Admin Page</a>
                </li>
                <!-- Проверка на наличие роли "USER" -->
                <li class="list-group-item" th:if="${@adminController.hasRole(currentUser, 'ROLE_USER')}">
                    <a href="http://localhost:8080/user">User Page</a>
                </li>
            </ul>
        </div>

        <div class="col-md-9">
            <h1>Admin, welcome to the Spring Boot security page!</h1>
            <br>

            <!-- Вкладки -->
            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" id="userListTab" data-toggle="tab" href="#userList">User List</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="addUserTab" data-toggle="tab" href="#addUser">Add User</a>
                </li>
            </ul>

            <div class="tab-content mt-3">
                <div class="tab-pane fade show active" id="userList">
                    <h1>User list</h1>
                    <form action="/admin/find" method="post">
                        <input type="number" name="id" placeholder="Enter User ID" required/>
                        <button type="submit" class="btn btn-primary">Find User</button>
                    </form>

                    <div th:if="${foundUser != null}">
                        <h2>Found User</h2>
                        <p>ID: <span th:text="${foundUser.id}"></span></p>
                        <p>Username: <span th:text="${foundUser.username}"></span></p>
                        <p>Email: <span th:text="${foundUser.email}"></span></p>
                        <p>Roles: <span th:each="role : ${foundUser.roles}" th:text="${role.name} + ' '"></span></p>
                    </div>
                    <br>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Roles</th>
                            <th>Action</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="user : ${users}">
                            <td th:text="${user.id}"></td>
                            <td th:text="${user.username}"></td>
                            <td th:text="${user.email}"></td>
                            <td>
                                <span th:each="role : ${user.roles}" th:text="${role.name} + ' '"></span>
                            </td>
                            <td>
                                <button class="btn btn-primary" data-toggle="modal" data-target="#updateModal" th:data-id="${user.id}" th:data-username="${user.username}" th:data-email="${user.email}" th:data-password="${user.password}">Update</button>
                                <button class="btn btn-danger" data-toggle="modal" data-target="#deleteModal" th:data-id="${user.id}">Delete</button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="tab-pane fade" id="addUser">
                    <h2>Add User</h2>
                    <form action="/admin/add" method="post" th:object="${user}">
                        <input type="text" th:field="*{username}" placeholder="Username" required/>
                        <input type="email" th:field="*{email}" placeholder="Email" required/>
                        <input type="password" th:field="*{password}" placeholder="Password" required/>
                        <label>Roles:</label>
                        <select th:field="*{roleNames}" multiple>
                            <option th:each="role : ${allRoles}" th:value="${role.name}" th:text="${role.name}"></option>
                        </select>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для обновления пользователя -->
<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="updateModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateModalLabel">Update User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="updateForm" action="/admin/update" method="post">
                    <input type="hidden" name="id" id="updateUserId"/>
                    <div class="form-group">
                        <label for="updateUsername">Username</label>
                        <input type="text" class="form-control" id="updateUsername" name="username" required/>
                    </div>
                    <div class="form-group">
                        <label for="updateEmail">Email</label>
                        <input type="email" class="form-control" id="updateEmail" name="email" required/>
                    </div>
                    <div class="form-group">
                        <label for="updatePassword">Password</label>
                        <input type="password" class="form-control" id="updatePassword" name="password" required/>
                    </div>
                    <button type="submit" class="btn btn-primary">Update User</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно для удаления пользователя -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Delete User</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this user?</p>
                <form id="deleteForm" action="/admin/delete" method="post">
                    <input type="hidden" name="id" id="deleteUserId"/>
                    <button type="submit" class="btn btn-danger">Delete User</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // Заполнение полей модального окна обновления
    $('#updateModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Кнопка, которая открыла модальное окно
        var userId = button.data('id');
        var username = button.data('username');
        var email = button.data('email');
        var password = button.data('password');

        var modal = $(this);
        modal.find('#updateUserId').val(userId);
        modal.find('#updateUsername').val(username);
        modal.find('#updateEmail').val(email);
        modal.find('#updatePassword').val(password);
    });

    // Заполнение поля модального окна удаления
    $('#deleteModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget); // Кнопка, которая открыла модальное окно
        var userId = button.data('id');

        var modal = $(this);
        modal.find('#deleteUserId').val(userId);
    });
</script>
</body>
</html>
